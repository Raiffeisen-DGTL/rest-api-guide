# Описание Spectral инструмента и структуры правил

## Что такое Spectral?

[Spectral](https://docs.stoplight.io/docs/spectral) - это гибкий линтер для спецификаций OpenAPI/Swagger, который
позволяет определять пользовательские правила
валидации. Он помогает обеспечить согласованность, полноту и соответствие документации API стандартам вашей организации.

## Что такое rulesets?

Rulesets (наборы правил) - это конфигурации, которые определяют, какие проверки должны выполняться на спецификациях API.
В этом проекте есть несколько основных наборов правил:

1. **Required Ruleset** - содержит обязательные правила валидации, которые должны быть соблюдены для публикации на портал
2. **AsyncAPI Required Ruleset** - содержит обязательные правила валидации AsyncAPI, которые должны быть соблюдены для публикации на портал
3. **Documentation Ruleset** - cодержит правила проверяющие качество документирования API:
   - Которые влияют на понимание написанной спецификации
   - Исправление которых не влияет на обратную совместимость API
   - Которые проверяют спецификацию на ошибки по OpenAPI стандарту
   - Правила из Required ruleset
4. **Base Ruleset** - cодержит полный набор правил проверки OpenAPI по API guide. 
5. **AI ready Ruleset** - содержит правила, помогающие определить готовность спецификации к использованию в MCP и AI агентах.
   


## Структура проекта

Проект организован следующим образом:

- `rules/` - содержит наборы правил
  - `asyncapi/`- правила для openAPI
    -  `required/` - обязательные правила
  - `openapi/` - правила для openAPI
- `functions/` - пользовательские функции, используемые в правилах
- `tests/` - тесты для проверки правил

## Сборка rulesets

Наборы правил собираются с помощью скрипта, который объединяет отдельные файлы правил в полные rulesets:

```bash
node ./build-rulesets.js
```
Этот скрипт генерирует:

- `required-ruleset.yaml` - объединенный обязательный ruleset
- `documentation-ruleset.yaml` - объединенный documentation ruleset
- `base-ruleset.yaml` - объединенный базовый ruleset
- `asyncapi-required-ruleset.yaml` - объединенный обязательный ruleset для AsyncAPI
- `ai-ready-ruleset.yaml` - объединенный AI ready ruleset

Данный файл не нужно запускать в ручную. Он будет автоматически запущен с помощью Husky Hooks при коммите изменений.

## Тестирование

Тесты запускаются с помощью Jest:

```bash
npm test
```

## Публикация

NPM пакет правил, содержащий  рулсеты, публикуется автоматически средствами Gitlab. 
Пайплайн для публикации создаётся после добавления тега в репозитории Gitlab. 
Версия пакета будет соответствовать тегу. 

## Версионирование

Проект следует принципам семантического версионирования. Подробнее [Процесс версионирования API Guide](../сontributing/VERSIONING.md).

## Contribute

Вы можете внести свой вклад в развитие автоматизированных правил, для этого ознакомьтесь с [CONTRIBUTING.md](../сontributing/CONTRIBUTING.md)
